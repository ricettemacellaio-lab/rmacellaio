<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roleta de Pr√™mios - Macellaio Style</title>
    <style>
        :root {
            --primary: #ffc107; /* Amarelo Ouro */
            --secondary: #d32f2f; /* Vermelho */
            --dark: #121212;
            --surface: #1e1e1e;
            --text: #ffffff;
            --gray: #757575;
            --success: #2e7d32;
        }

        * { box-sizing: border-box; user-select: none; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        body {
            margin: 0;
            padding: 0;
            background-color: var(--dark);
            color: var(--text);
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        /* Overlay escuro para melhorar leitura sobre fundo */
        .bg-overlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.85); z-index: -1;
        }

        /* Container Principal */
        .app-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
            width: 100%;
            position: relative;
        }

        h1, h2 { text-align: center; color: var(--primary); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; }
        p { text-align: center; color: #ccc; }

        /* Canvas da Roleta */
        .wheel-wrapper {
            position: relative;
            width: 320px;
            height: 320px;
            margin: 20px auto;
        }
        canvas { width: 100%; height: 100%; border-radius: 50%; box-shadow: 0 0 20px rgba(255, 193, 7, 0.2); }

        /* Seta Indicadora (Tri√¢ngulo no topo) */
        .indicator {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0; 
            height: 0; 
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 25px solid var(--primary);
            z-index: 10;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.5));
        }

        /* Dardo */
        .dart-container {
            position: absolute;
            bottom: -50px; /* Come√ßa fora */
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 80px;
            z-index: 20;
            transition: bottom 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            opacity: 0;
        }
        .dart-container.ready { bottom: 20px; opacity: 0.5; } /* Fantasma/Mira */
        .dart-container.thrown { bottom: 0px; opacity: 1; transition: bottom 0.2s ease-in; }
        
        /* SVG do Dardo simples */
        .dart-svg {
            width: 100%; height: 100%;
            filter: drop-shadow(0 4px 4px rgba(0,0,0,0.8));
        }

        /* Bot√µes */
        .btn {
            background: var(--primary);
            color: #000;
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            width: 100%;
            max-width: 300px;
            margin: 10px auto;
            display: block;
            transition: transform 0.1s;
            box-shadow: 0 4px 15px rgba(255, 193, 7, 0.4);
        }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { background: var(--gray); cursor: not-allowed; box-shadow: none; }
        
        .btn-secondary { background: transparent; border: 2px solid var(--text); color: var(--text); box-shadow: none; }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--secondary); color: white; }

        /* Painel Admin */
        #admin-panel {
            display: none;
            width: 100%;
            background: var(--surface);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            color: #fff;
        }
        
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: var(--primary); font-size: 0.9rem; }
        input, select {
            width: 100%; padding: 10px;
            background: #333; border: 1px solid #444; color: white; border-radius: 5px;
        }
        
        table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
        th, td { text-align: left; padding: 8px; border-bottom: 1px solid #333; font-size: 0.9rem; }
        th { color: var(--primary); }
        .action-btn { padding: 5px 10px; border-radius: 4px; border: none; cursor: pointer; font-size: 0.8rem; }

        /* Modais / Telas de Resultado */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: none; align-items: center; justify-content: center;
            z-index: 100;
            padding: 20px;
        }
        .modal-content {
            background: var(--surface);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid #333;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
            position: relative;
        }
        
        .prize-box {
            border: 2px dashed var(--primary);
            padding: 15px;
            margin: 20px 0;
            font-size: 1.5rem;
            color: var(--primary);
            font-weight: bold;
            background: rgba(255, 193, 7, 0.1);
        }

        .coupon-display {
            background: #000;
            color: #fff;
            padding: 10px;
            font-family: monospace;
            font-size: 1.2rem;
            letter-spacing: 2px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #444;
        }

        /* Anima√ß√£o de Shake */
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        .hidden { display: none !important; }
        .status-badge { 
            position: absolute; top: 10px; right: 10px; 
            background: #333; padding: 5px 10px; border-radius: 20px; font-size: 0.8rem; 
        }
    </style>
</head>
<body>

    <div class="bg-overlay"></div>

    <div class="app-container" id="game-view">
        <div class="status-badge">Tentativa: <span id="attempt-counter">1</span>/3</div>
        
        <h2 id="brand-title">MACELLAIO REWARDS</h2>
        
        <div class="wheel-wrapper">
            <div class="indicator"></div> 
            <canvas id="wheelCanvas" width="320" height="320"></canvas>
            
            <div class="dart-container" id="dart">
                <svg class="dart-svg" viewBox="0 0 24 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 0L15 10L24 12L15 14L12 64L9 14L0 12L9 10L12 0Z" fill="#d32f2f"/>
                    <path d="M12 0L15 10L12 64L9 10L12 0Z" fill="#b71c1c"/>
                    <circle cx="12" cy="12" r="2" fill="gold"/>
                </svg>
            </div>
        </div>

        <p id="instruction-text">Clique para girar a roleta</p>
        
        <button id="action-btn" class="btn">GIRAR ROLETA</button>
        
        <button id="force-redeem-btn" class="btn btn-success hidden">RESGATAR PR√äMIO</button>
    </div>

    <div id="result-modal" class="modal">
        <div class="modal-content">
            <h3>Resultado!</h3>
            <div id="result-prize-name" class="prize-box">???</div>
            <p>Voc√™ ainda tem tentativas. Quer tentar um pr√™mio melhor?</p>
            <button id="btn-keep-playing" class="btn btn-secondary">Tentar de Novo</button>
            <button id="btn-redeem-now" class="btn btn-success">Garantir este Pr√™mio</button>
        </div>
    </div>

    <div id="final-modal" class="modal">
        <div class="modal-content">
            <h3>üéâ PARAB√âNS!</h3>
            <p>Seu pr√™mio foi garantido.</p>
            <div id="final-prize-name" class="prize-box">FRETE GR√ÅTIS</div>
            <div class="coupon-display" id="final-coupon">FREE</div>
            <p style="font-size:0.8rem">V√°lido at√©: <span id="validity-date"></span></p>
            
            <button class="btn" onclick="copyCoupon()">COPIAR C√ìDIGO</button>
            <button class="btn btn-success" onclick="openWhatsapp()">RESGATAR NO WHATSAPP</button>
        </div>
    </div>

    <div id="admin-view" class="app-container hidden">
        <h2>Administra√ß√£o</h2>
        <div id="admin-panel">
            <div class="form-group">
                <label>Nome da Campanha</label>
                <input type="text" id="camp-name" value="Macellaio Promo">
            </div>
            
            <div class="form-group">
                <label>URL Imagem de Fundo (Opcional)</label>
                <input type="text" id="bg-url" placeholder="https://...">
            </div>

            <h3>Pr√™mios & Pesos</h3>
            <table id="prizes-table">
                <thead>
                    <tr>
                        <th>Pr√™mio</th>
                        <th>Cupom</th>
                        <th>Peso (0-100)</th>
                        <th>A√ß√£o</th>
                    </tr>
                </thead>
                <tbody id="prizes-list">
                    </tbody>
            </table>
            <button class="action-btn" style="background:#444; color:#fff; width:100%" onclick="addPrizeRow()">+ Adicionar Item</button>

            <hr style="border-color:#333; margin: 20px 0">
            
            <div class="form-group">
                <label>Link para Compartilhar (Gerado)</label>
                <input type="text" id="share-link" readonly onclick="this.select()">
            </div>
            
            <button class="btn" onclick="generateLink()">GERAR LINK & SALVAR</button>
            <button class="btn btn-secondary" onclick="window.location.reload()">VOLTAR / TESTAR</button>
        </div>
    </div>

<script>
/**
 * L√ìGICA DO SISTEMA
 * 1. Gerenciamento de Estado (GameLogic)
 * 2. Canvas e Anima√ß√£o (Renderer)
 * 3. Administra√ß√£o e Gera√ß√£o de Links (Admin)
 */

// --- CONFIGURA√á√ÉO PADR√ÉO ---
const DEFAULT_PRIZES = [
    { name: "10% OFF", coupon: "DESC10", weight: 10, color: "#d32f2f" },
    { name: "Frete Gr√°tis", coupon: "FREE", weight: 5, color: "#2e7d32" },
    { name: "Sobremesa", coupon: "DOCE", weight: 10, color: "#f57f17" },
    { name: "5% OFF", coupon: "DESC05", weight: 30, color: "#fbc02d" },
    { name: "Tente de Novo", coupon: "", weight: 20, color: "#607d8b" }, // Sem pr√™mio
    { name: "BOGO", coupon: "BOGO", weight: 2, color: "#7b1fa2" }
];

const COLORS = ["#d32f2f", "#1976d2", "#388e3c", "#fbc02d", "#7b1fa2", "#e64a19", "#5d4037", "#616161"];

// --- UTILIT√ÅRIOS ---
function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
}

// Codifica√ß√£o simples para o link (Base64 de JSON minificado)
function encodeConfig(config) {
    try {
        const json = JSON.stringify(config);
        return btoa(encodeURIComponent(json)); // encodeURI p/ suportar acentos
    } catch (e) { console.error(e); return ""; }
}

function decodeConfig(str) {
    try {
        const json = decodeURIComponent(atob(str));
        return JSON.parse(json);
    } catch (e) { console.error("Erro ao decodificar config", e); return null; }
}

// --- ENGINE DO JOGO ---
const Game = {
    token: null,
    prizes: [],
    maxAttempts: 3,
    state: {
        attemptsUsed: 0,
        history: [], // { prizeIndex, timestamp }
        redeemed: false,
        redeemedIndex: null
    },
    canvas: null,
    ctx: null,
    currentRotation: 0,
    isSpinning: false,
    phase: 'idle', // idle, spinning, waiting_throw, throwing, settling, finished

    init: function() {
        this.canvas = document.getElementById('wheelCanvas');
        this.ctx = this.canvas.getContext('2d');
        
        // 1. Carregar Configura√ß√£o da Campanha
        const configData = getQueryParam('c');
        if (configData) {
            const config = decodeConfig(configData);
            if (config) {
                this.prizes = config.prizes;
                document.getElementById('brand-title').innerText = config.name || "ROLETTA";
                if(config.bg) document.body.style.backgroundImage = `url('${config.bg}')`;
            }
        } else {
            this.prizes = JSON.parse(JSON.stringify(DEFAULT_PRIZES)); // Clone
        }

        // Atribuir cores se n√£o tiver
        this.prizes.forEach((p, i) => {
            if(!p.color) p.color = COLORS[i % COLORS.length];
        });

        // 2. Identificar Token e Carregar Estado Local
        this.token = getQueryParam('t') || 'demo_' + Math.floor(Math.random()*1000);
        this.loadState();

        // 3. Render Inicial
        this.drawWheel();
        this.updateUI();

        // 4. Event Listeners
        document.getElementById('action-btn').addEventListener('click', () => this.handleAction());
        document.getElementById('btn-keep-playing').addEventListener('click', () => this.closeResultModal());
        document.getElementById('btn-redeem-now').addEventListener('click', () => this.redeemCurrent());
        
        // Admin Trigger
        if (getQueryParam('admin') === '1') {
            document.getElementById('game-view').classList.add('hidden');
            document.getElementById('admin-view').classList.remove('hidden');
            Admin.init(this.prizes);
        }
    },

    loadState: function() {
        const saved = localStorage.getItem('roleta_' + this.token);
        if (saved) {
            this.state = JSON.parse(saved);
        }
    },

    saveState: function() {
        localStorage.setItem('roleta_' + this.token, JSON.stringify(this.state));
    },

    // A L√≥gica de Pesos
    determineOutcome: function() {
        const totalWeight = this.prizes.reduce((sum, p) => sum + parseInt(p.weight || 0), 0);
        let random = Math.random() * totalWeight;
        
        // Se todos pesos forem 0, random puro
        if (totalWeight <= 0) return Math.floor(Math.random() * this.prizes.length);

        for (let i = 0; i < this.prizes.length; i++) {
            random -= parseInt(this.prizes[i].weight || 0);
            if (random < 0) return i;
        }
        return 0;
    },

    handleAction: function() {
        const btn = document.getElementById('action-btn');

        if (this.state.redeemed) return; // J√° acabou

        if (this.phase === 'idle') {
            // Checar limites
            if (this.state.attemptsUsed >= this.maxAttempts) {
                this.showForceRedeem();
                return;
            }

            // Iniciar Giro
            this.phase = 'spinning';
            btn.innerText = "PREPARE-SE...";
            btn.disabled = true;
            this.spinAnimation();
            
            // Determinar resultado agora, mas s√≥ mostrar no final
            this.targetIndex = this.determineOutcome();
            
            // Agendar libera√ß√£o do dardo
            setTimeout(() => {
                this.phase = 'waiting_throw';
                btn.innerText = "ARREMESSAR DARDO!";
                btn.classList.add('btn-danger'); // Cor de a√ß√£o
                btn.disabled = false;
                
                // Mostrar "ghost" do dardo
                const dart = document.getElementById('dart');
                dart.classList.add('ready');
            }, 2000); // 2 segundos de giro livre antes de poder jogar
        } 
        else if (this.phase === 'waiting_throw') {
            // Jogador clicou para arremessar
            this.phase = 'throwing';
            btn.disabled = true;
            btn.innerText = "VAI!";
            
            // Animar Dardo
            const dart = document.getElementById('dart');
            dart.classList.remove('ready');
            dart.classList.add('thrown');

            // Quando dardo bater (simulado pelo tempo CSS)
            setTimeout(() => {
                this.phase = 'settling';
                // Adicionar shake na tela
                document.body.classList.add('shake');
                setTimeout(()=>document.body.classList.remove('shake'), 500);
                
                // Calcular frenagem para parar no alvo (posi√ß√£o 6h = 90deg ou PI/2)
                this.calculateStop();
            }, 250);
        }
    },

    spinAnimation: function() {
        if (this.phase === 'finished') return;

        // Velocidade base
        if (this.phase === 'spinning' || this.phase === 'waiting_throw') {
            this.currentRotation += 0.2; // R√°pido
        } 
        else if (this.phase === 'settling') {
            // Lerp para o alvo
            const diff = this.targetRotation - this.currentRotation;
            this.currentRotation += diff * 0.05; // Suaviza√ß√£o exponencial (f√≠sica de peso)
            
            if (Math.abs(diff) < 0.001) {
                this.phase = 'finished';
                this.showRoundResult();
            }
        }

        this.drawWheel();
        requestAnimationFrame(() => this.spinAnimation());
    },

    calculateStop: function() {
        // Queremos que o √≠ndice alvo esteja em baixo (PI/2 radianos)
        const segmentAngle = (2 * Math.PI) / this.prizes.length;
        
        // √Çngulo onde o pr√™mio come√ßa (centro do segmento)
        // No canvas padr√£o, 0 √© 3h. Sentido hor√°rio.
        // Centro do segmento i: i * segmentAngle + segmentAngle/2
        
        // Queremos alinhar esse centro com PI/2 (6h)
        // Rota√ß√£o da Roda + Angulo do Segmento = PI/2 + (voltas completas)
        
        const targetSegmentAngle = this.targetIndex * segmentAngle + (segmentAngle/2);
        
        // A posi√ß√£o atual visualmente √© (currentRotation % 2PI).
        // Queremos chegar num valor targetRotation tal que:
        // targetRotation + targetSegmentAngle = PI/2 (mod 2PI)
        // => targetRotation = PI/2 - targetSegmentAngle
        
        let desiredRot = (Math.PI / 2) - targetSegmentAngle;
        
        // Ajustar para ser maior que a rota√ß√£o atual para n√£o girar para tr√°s
        while (desiredRot < this.currentRotation + (Math.PI * 2)) { // Pelo menos mais 1 volta visual
            desiredRot += (Math.PI * 2);
        }
        
        this.targetRotation = desiredRot;
    },

    drawWheel: function() {
        const ctx = this.ctx;
        const numSegments = this.prizes.length;
        const arc = (Math.PI * 2) / numSegments;
        const radius = 160;
        const cx = 160;
        const cy = 160;

        ctx.clearRect(0,0,320,320);
        
        ctx.save();
        ctx.translate(cx, cy);
        ctx.rotate(this.currentRotation);

        for (let i = 0; i < numSegments; i++) {
            const angle = i * arc;
            ctx.beginPath();
            ctx.fillStyle = this.prizes[i].color;
            ctx.moveTo(0, 0);
            ctx.arc(0, 0, radius, angle, angle + arc);
            ctx.fill();
            ctx.stroke();

            // Texto
            ctx.save();
            ctx.translate(Math.cos(angle + arc / 2) * (radius - 40), Math.sin(angle + arc / 2) * (radius - 40));
            ctx.rotate(angle + arc / 2);
            ctx.fillStyle = "#fff";
            ctx.font = 'bold 14px Arial';
            ctx.fillText(this.prizes[i].name, 20, 5); // Simplificado
            ctx.restore();
        }
        ctx.restore();
        
        // Efeito de sombra interna central
        ctx.beginPath();
        ctx.arc(cx, cy, 30, 0, 2 * Math.PI);
        ctx.fillStyle = "#1e1e1e";
        ctx.fill();
    },

    showRoundResult: function() {
        // Atualizar estado
        this.state.attemptsUsed++;
        const wonPrize = this.prizes[this.targetIndex];
        this.state.history.push({ index: this.targetIndex, name: wonPrize.name, coupon: wonPrize.coupon });
        this.saveState();

        // Mostrar Modal
        setTimeout(() => {
            document.getElementById('result-prize-name').innerText = wonPrize.name;
            const modal = document.getElementById('result-modal');
            const btnKeep = document.getElementById('btn-keep-playing');
            
            // Se cupom vazio (Tente de Novo)
            if (!wonPrize.coupon) {
                 document.getElementById('btn-redeem-now').style.display = 'none';
            } else {
                 document.getElementById('btn-redeem-now').style.display = 'inline-block';
            }

            // L√≥gica do bot√£o "Tentar de novo"
            if (this.state.attemptsUsed >= this.maxAttempts) {
                btnKeep.innerText = "Ver Meus Pr√™mios"; // Mudan√ßa de fluxo
                btnKeep.onclick = () => this.showForceRedeem();
            } else {
                btnKeep.innerText = "Tentar de Novo (" + (this.maxAttempts - this.state.attemptsUsed) + " restantes)";
                btnKeep.onclick = () => this.closeResultModal();
            }

            modal.style.display = 'flex';
        }, 500);
    },

    closeResultModal: function() {
        document.getElementById('result-modal').style.display = 'none';
        this.resetRound();
    },

    resetRound: function() {
        this.phase = 'idle';
        const btn = document.getElementById('action-btn');
        btn.disabled = false;
        btn.innerText = "GIRAR ROLETA";
        btn.classList.remove('btn-danger');
        
        const dart = document.getElementById('dart');
        dart.classList.remove('thrown');
        dart.classList.remove('ready');
        
        this.updateUI();
    },

    redeemCurrent: function() {
        // Usu√°rio escolheu o pr√™mio atual
        const lastWin = this.state.history[this.state.history.length -1];
        if (!lastWin.coupon) return; // Seguran√ßa

        this.finishGame(lastWin);
    },

    showForceRedeem: function() {
        // Mostra lista de pr√™mios v√°lidos ganhos para escolher
        // Simplifica√ß√£o: pega o melhor (ou o √∫ltimo v√°lido) para demo
        // Num app real, listaria todos. Aqui pegaremos o √∫ltimo v√°lido.
        
        const validPrizes = this.state.history.filter(h => h.coupon && h.coupon.length > 0);
        
        if (validPrizes.length === 0) {
            alert("Poxa! Suas tentativas acabaram e voc√™ n√£o ganhou pr√™mios. Fale com o gerente!");
            return;
        }

        // Se tiver mais de um, poderia abrir um modal de sele√ß√£o. 
        // Vamos assumir o √∫ltimo ganho como padr√£o para simplificar o arquivo √∫nico.
        this.finishGame(validPrizes[validPrizes.length - 1]);
    },

    finishGame: function(prizeObj) {
        this.state.redeemed = true;
        this.state.redeemedPrize = prizeObj;
        this.saveState();

        document.getElementById('result-modal').style.display = 'none';
        document.getElementById('game-view').classList.add('hidden'); // Esconde jogo
        
        // Preenche Modal Final
        document.getElementById('final-prize-name').innerText = prizeObj.name;
        document.getElementById('final-coupon').innerText = prizeObj.coupon;
        
        // Data + 7 dias
        const d = new Date(); d.setDate(d.getDate() + 7);
        document.getElementById('validity-date').innerText = d.toLocaleDateString();

        document.getElementById('final-modal').style.display = 'flex';
    },

    updateUI: function() {
        document.getElementById('attempt-counter').innerText = this.state.attemptsUsed + 1;
        if (this.state.redeemed) {
            this.finishGame(this.state.redeemedPrize);
        } else if (this.state.attemptsUsed >= this.maxAttempts && this.phase === 'idle') {
            document.getElementById('action-btn').classList.add('hidden');
            document.getElementById('force-redeem-btn').classList.remove('hidden');
            document.getElementById('force-redeem-btn').onclick = () => this.showForceRedeem();
            document.getElementById('instruction-text').innerText = "Tentativas esgotadas.";
        }
    }
};

// --- ADMIN LOGIC ---
const Admin = {
    prizes: [],
    init: function(currentPrizes) {
        this.prizes = currentPrizes;
        this.renderTable();
    },
    
    renderTable: function() {
        const tbody = document.getElementById('prizes-list');
        tbody.innerHTML = '';
        this.prizes.forEach((p, index) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td><input type="text" value="${p.name}" onchange="Admin.update(${index}, 'name', this.value)"></td>
                <td><input type="text" value="${p.coupon}" onchange="Admin.update(${index}, 'coupon', this.value)"></td>
                <td><input type="number" value="${p.weight}" min="0" max="100" onchange="Admin.update(${index}, 'weight', this.value)"></td>
                <td><button class="action-btn" onclick="Admin.remove(${index})" style="background:#b71c1c; color:white">X</button></td>
            `;
            tbody.appendChild(tr);
        });
    },

    update: function(index, field, value) {
        this.prizes[index][field] = value;
    },

    remove: function(index) {
        if (confirm('Remover este pr√™mio?')) {
            this.prizes.splice(index, 1);
            this.renderTable();
        }
    },
    
    add: function() {
        this.prizes.push({ name: "Novo Item", coupon: "CODIGO", weight: 10, color: COLORS[this.prizes.length % COLORS.length] });
        this.renderTable();
    }
};

function addPrizeRow() { Admin.add(); }

function generateLink() {
    const name = document.getElementById('camp-name').value;
    const bg = document.getElementById('bg-url').value;
    
    // Config object
    const config = {
        name: name,
        bg: bg,
        prizes: Admin.prizes
    };

    const encoded = encodeConfig(config);
    const baseUrl = window.location.href.split('?')[0];
    
    // Token placeholder para testar
    const finalLink = `${baseUrl}?t=CLIENTE001&c=${encoded}`;
    
    document.getElementById('share-link').value = finalLink;
    alert("Link gerado! Copie o campo abaixo.\n\nIMPORTANTE: O link cont√©m toda a configura√ß√£o. Se mudar a imagem ou pr√™mios, gere um novo link.");
}

// --- FUN√á√ïES FINAIS ---
function copyCoupon() {
    const code = document.getElementById('final-coupon').innerText;
    navigator.clipboard.writeText(code).then(() => alert("C√≥digo copiado!"));
}

function openWhatsapp() {
    const code = document.getElementById('final-coupon').innerText;
    const prize = document.getElementById('final-prize-name').innerText;
    const text = `Ol√°! Ganhei o pr√™mio *${prize}* na roleta (C√≥digo: ${code}). Gostaria de resgatar!`;
    window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
}

// Inicializar
window.onload = function() {
    Game.init();
};

</script>
</body>
</html>